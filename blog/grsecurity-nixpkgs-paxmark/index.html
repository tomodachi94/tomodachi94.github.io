<!doctype html><html lang=en-us><head><meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>grsecurity in Nixpkgs: an obituary (or: what was 'paxmark'?) | Tomodachi94's Musings</title><meta name=title content="grsecurity in Nixpkgs: an obituary (or: what was 'paxmark'?)"><meta name=description content="This post aims to provide a bunch of historical background around PaX and grsecurity support in Nixpkgs.
It is fairly abstract and can probably be digested by non-Nix people with ease.
This post is mostly focused on the implementation in Nixpkgs; I am not an expect in PaX/grsecurity (so if I&rsquo;ve gotten something wrong, please correct me).
I&rsquo;m also partially writing this so that people know what paxmark was, in case they encounter a reference to it."><meta name=keywords content="Nixpkgs,PaX,grsecurity,OpenPaX,Linux,"><meta property="og:url" content="https://tomodachi94.github.io/blog/grsecurity-nixpkgs-paxmark/"><meta property="og:site_name" content="Tomodachi94's Musings"><meta property="og:title" content="grsecurity in Nixpkgs: an obituary (or: what was 'paxmark'?)"><meta property="og:description" content="This post aims to provide a bunch of historical background around PaX and grsecurity support in Nixpkgs. It is fairly abstract and can probably be digested by non-Nix people with ease.
This post is mostly focused on the implementation in Nixpkgs; I am not an expect in PaX/grsecurity (so if I’ve gotten something wrong, please correct me).
I’m also partially writing this so that people know what paxmark was, in case they encounter a reference to it."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2025-02-11T00:00:00+00:00"><meta property="article:modified_time" content="2025-02-11T00:00:00+00:00"><meta property="article:tag" content="Nixpkgs"><meta property="article:tag" content="PaX"><meta property="article:tag" content="Grsecurity"><meta property="article:tag" content="OpenPaX"><meta property="article:tag" content="Linux"><meta name=twitter:card content="summary"><meta name=twitter:title content="grsecurity in Nixpkgs: an obituary (or: what was 'paxmark'?)"><meta name=twitter:description content="This post aims to provide a bunch of historical background around PaX and grsecurity support in Nixpkgs. It is fairly abstract and can probably be digested by non-Nix people with ease.
This post is mostly focused on the implementation in Nixpkgs; I am not an expect in PaX/grsecurity (so if I’ve gotten something wrong, please correct me).
I’m also partially writing this so that people know what paxmark was, in case they encounter a reference to it."><meta itemprop=name content="grsecurity in Nixpkgs: an obituary (or: what was 'paxmark'?)"><meta itemprop=description content="This post aims to provide a bunch of historical background around PaX and grsecurity support in Nixpkgs. It is fairly abstract and can probably be digested by non-Nix people with ease.
This post is mostly focused on the implementation in Nixpkgs; I am not an expect in PaX/grsecurity (so if I’ve gotten something wrong, please correct me).
I’m also partially writing this so that people know what paxmark was, in case they encounter a reference to it."><meta itemprop=datePublished content="2025-02-11T00:00:00+00:00"><meta itemprop=dateModified content="2025-02-11T00:00:00+00:00"><meta itemprop=wordCount content="593"><meta itemprop=keywords content="Nixpkgs,PaX,Grsecurity,OpenPaX,Linux"><meta name=referrer content="no-referrer-when-downgrade"><style>:root{--width:720px;--font-main:Verdana, sans-serif;--font-secondary:Verdana, sans-serif;--font-scale:1em;--background-color:#fff;--heading-color:#222;--text-color:#444;--link-color:#3273dc;--visited-color:#8b6fcb;--blockquote-color:#222}@media(prefers-color-scheme:dark){:root{--background-color:#01242e;--heading-color:#eee;--text-color:#ddd;--link-color:#8cc2dd;--visited-color:#8b6fcb;--blockquote-color:#ccc}}body{font-family:var(--font-secondary);font-size:var(--font-scale);margin:auto;padding:20px;max-width:var(--width);text-align:left;background-color:var(--background-color);word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:var(--text-color)}h1,h2,h3,h4,h5,h6{font-family:var(--font-main);color:var(--heading-color)}a{color:var(--link-color);cursor:pointer;text-decoration:none}a:hover{text-decoration:underline}nav a{margin-right:8px}strong,b{color:var(--heading-color)}button{margin:0;cursor:pointer}time{font-family:monospace;font-style:normal;font-size:15px}main{line-height:1.6}table{width:100%}hr{border:0;border-top:1px dashed}img{max-width:100%}code{font-family:monospace;padding:2px;border-radius:3px}blockquote{border-left:1px solid #999;color:var(--blockquote-color);padding-left:20px;font-style:italic}footer{padding:25px 0;text-align:center}.title:hover{text-decoration:none}.title h1{font-size:1.5em}.inline{width:auto !important}.highlight,.code{border-radius:3px;margin-block-start:1em;margin-block-end:1em;overflow-x:auto}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:var(--visited-color)}</style><a href=https://github.com/tomodachi94 rel=me><link rel=webmention href=https://webmention.io/tomodachi94.github.io/webmention><meta name=msvalidate.01 content="71EF19DC0F6663464BD8C4E5919D51C6"></head><body><header><a href=/ class=title><h2>Tomodachi94's Musings</h2></a><nav></nav></header><main><h1>grsecurity in Nixpkgs: an obituary (or: what was 'paxmark'?)</h1><p><i><time datetime=2025-02-11>11 Feb, 2025</time></i></p><content><p>This post aims to provide a bunch of historical background around <a href=https://pax.grsecurity.net/>PaX</a> and <a href=https://grsecurity.net>grsecurity</a> support in Nixpkgs.
It is fairly abstract and can probably be digested by non-Nix people with ease.</p><p>This post is mostly focused on the implementation in Nixpkgs; I am not an expect in PaX/grsecurity (so if I&rsquo;ve gotten something wrong, please correct me).</p><p>I&rsquo;m also partially writing this so that people know what paxmark was, in case they encounter a reference to it.</p><h2 id=background>Background</h2><p><a href=https://pax.grsecurity.net/>PaX</a> was an ecosystem of Linux patches and command-line tools which aimed to improve the security of Linux systems by <a href=https://pax.grsecurity.net/docs/pax.txt>making it more difficult to abuse arbitrary code injection attacks</a>.</p><p>Development was initially started by the PaX team <a href=https://grsecurity.net/faq#paxgrsec>in 2000</a>, eventually being adopted into the grsecurity project.</p><p>Development of standalone PaX ceased sometime in 2013, eventually becoming integrated into grsecurity. grsecurity <a href=https://grsecurity.net/passing_the_baton>ceased providing free Linux kernel patches and other grsecurity software in April 2017</a>.</p><h2 id=the-rise-patches-submitted-to-nixpkgs>The rise: patches submitted to Nixpkgs</h2><p>The grsecurity patches were <a href=https://github.com/NixOS/nixpkgs/commit/af2a12755113d8c1e1464fbe20ead31389a66e32>submitted to Nixpkgs in July 2013</a> by <a href=https://github.com/rbvermaa>Rob Vermaas</a> with the update to <a href=https://kernelnewbies.org/Linux_3.2>Linux 3.2</a>.</p><p>Maintenance in 2013 and 2014 was primarily conducted by <a href=https://github.com/wizeman>wizeman</a> and <a href=https://github.com/Phreedom>Evgeny Egorochkin</a>, with <a href=https://github.com/thoughtpolice>Austin Seipp</a> starting to submit patches in 2014.
Egorochkin stopped submitting patches in 2014.</p><p>copumpkin and tg-x began submitting fixes in 2016.</p><p>joachifm and wkennington began submitting patches regularly in 2015, continuing to do so until grsecurity&rsquo;s removal in 2018 (more on that later).
wizeman continued to submit patches to grsecurity in Nixpkgs until mid-2015; after that, we saw a sharp decline in their activity in Nixpkgs.</p><h2 id=the-middle-era-adding-support-to-more-packages-with-paxmark>The middle era: adding support to more packages with <code>paxmark</code></h2><h3 id=what-is-paxmark>What is <code>paxmark</code>?</h3><p>In short, <code>paxmark</code> was a wrapper formerly included in <code>stdenv</code> (and <a href=https://github.com/NixOS/nixpkgs/pull/52661>later moved to <code>paxctl</code>&rsquo;s setup hook</a>) which thinly wrapped <code>paxctl</code> with options that were commonly used at the time in Nixpkgs.</p><p>Here&rsquo;s some documentation I wrote as part of a documentation campaign but never submitted to Nixpkgs (which <em>totally</em> isn&rsquo;t the reason I&rsquo;m writing this blog post at all, no no no <code>/sarc</code>):</p><blockquote><h4 id=paxctl>paxctl</h4><p>This setup hook exposes a function, <code>paxmark</code>, which uses <code>paxctl</code> to manipulate the <a href=https://en.wikipedia.org/wiki/Executable-space_protection#PaX>PaX</a> flags in a standard way:</p><ul><li>Convert the headers from the old-style <code>PT_GNU_STACK</code> program header to the newer <code>PT_PAX_FLAGS</code> header.</li><li>Reset all previous flags, then set the <code>NOEMUTRAMP</code> and <code>NORANDEXEC</code> flags.</li></ul></blockquote><h3 id=paxmark-proliferation><code>paxmark</code> proliferation</h3><p>Packages which need some advanced memory management features need to be explicitly whitelisted in PaX.
People started adding <code>paxmark</code> commands to packages <a href=https://github.com/NixOS/nixpkgs/commit/4f745ce8b27bbb3ca6fac8ad314bcc4bfd025f87>as early as 2014</a>, with roughly 60 packages containing <code>paxmark</code> by 2018.</p><h2 id=the-decline-licensing-lockdown-removal-from-nixpkgs>The decline: licensing lockdown, removal from Nixpkgs</h2><p>In 2017, grsecurity made the decision to change the licensing of their patches from GPL to a proprietary licensing arrangement, requiring payment.</p><p>Support for the patches <a href=https://github.com/NixOS/nixpkgs/pull/25277>was promptly removed from Nixpkgs</a> based on concerns that we could no longer reliably support grsecurity.
Similar moves were made by some other distributions; <a href=https://lwn.net/Articles/721848>LWN.net has an excellent overview</a> for the curious.</p><p>Even after the patches were removed from Nixpkgs, much of its infrastructure and tooling lingered (with some things, like <a href=https://github.com/NixOS/nixpkgs/pull/118576/files>the removal of the grsecurity NixOS options</a>, <a href=https://github.com/NixOS/nixpkgs/pull/52983/commits/1b146a8c6f55b23981c3817d8346f95bb3a799fe>the <code>paxmark</code> function&rsquo;s removal from <code>stdenv</code></a> and then <a href=https://github.com/NixOS/nixpkgs/pull/349693>from Nixpkgs</a>, being removed piecemeal).
Much of it was left in place with the hopes that a successor would take off, but I haven&rsquo;t noticed much activity on this.</p><h2 id=a-successor>A successor?</h2><p>In November 2024, <a href=https://thenewstack.io/openpax-a-new-linux-memory-security-patch-arrives/>OpenPaX</a> was released by Edera, a security company.
OpenPaX intended to be an open-source replacement for grsecurity&rsquo;s PaX.</p><p>Alpine Linux has <a href=https://pkgs.alpinelinux.org/package/edge/community/aarch64/linux-openpax>packaged the patches</a>; it&rsquo;s unclear if other distributions have done so.
Nixpkgs does not have the patches available as of writing (February 2025).</p></content><p><a href=https://tomodachi94.github.io/tags/nixpkgs/>#Nixpkgs</a>
<a href=https://tomodachi94.github.io/tags/pax/>#PaX</a>
<a href=https://tomodachi94.github.io/tags/grsecurity/>#Grsecurity</a>
<a href=https://tomodachi94.github.io/tags/openpax/>#OpenPaX</a>
<a href=https://tomodachi94.github.io/tags/linux/>#Linux</a></p></main><footer>Made with <a href=https://github.com/janraasch/hugo-bearblog/>Hugo ʕ•ᴥ•ʔ Bear</a> &bull; &#169; 2025 Tomodachi94 - All Rights Reserved &bull; <a href=https://github.com/tomodachi94/tomodachi94.github.io>Source</a></footer><i></i>
<script data-goatcounter=https://tomodachi94.goatcounter.com/count async src=https://gc.zgo.at/count.js></script></body></html>